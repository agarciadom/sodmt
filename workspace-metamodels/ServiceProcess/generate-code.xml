<?xml version="1.0" encoding="UTF-8"?>
<project name="serviceProcess" default="default">

	<!-- PROPERTIES ####################################################### -->

	<!-- Basic project info -->
	<property name="project.name" value="ServiceProcess" />
	<property name="model.dir" value="model" />
	<property name="model.basename" value="serviceprocess" />

	<!-- File locations -->
	<property name="copyright.location" value="${model.dir}/copyright.txt" />
	<property name="common.fragment.location" value="${model.dir}/common.emf.fragment" />
	<property name="emfatic.template.location" value="${model.dir}/${model.basename}.emf.template" />
	<property name="emfatic.location" value="${model.dir}/${model.basename}.emf" />
	<property name="ecore.location" value="${model.dir}/${model.basename}.ecore" />

	<!-- MAIN BODY ######################################################## -->

	<target name="init">
		<tstamp />
	</target>

	<target name="refreshEmfatic" if="eclipse.application" depends="init">
        <echo>Refreshing the project directory under Eclipse</echo>
        <eclipse.refreshLocal resource="/${project.name}" depth="infinite"/>
    </target>

	<target name="generateEmfatic" depends="refreshEmfatic">
		<echo>Generating Emfatic source ${emfatic.location} from its template</echo>
		<loadfile srcFile="${common.fragment.location}" property="common.fragment.contents" />
		<copy file="${emfatic.template.location}" tofile="${emfatic.location}">
		  <filterset begintoken="/*@" endtoken="@*/" recurse="false">
		    <filter token="COMMON_FRAGMENT" value="${common.fragment.contents}"/>
	          </filterset>
		</copy>
    </target>

	<target name="default" depends="generateEmfatic">
		<echo>Running Eugenia...</echo>
		<epsilon.eugenia src="${emfatic.location}"/>
		<echo>Registering metamodel permanently...</echo>
		<epsilon.emf.register permanently="true" file="${ecore.location}"/>
	</target>

</project>
